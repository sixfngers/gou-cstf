package com.site{	import flash.display.DisplayObjectContainer;	import flash.display.MovieClip;	import flash.display.Sprite;	import flash.text.*	import flash.events.Event	import flash.events.MouseEvent		import com.greensock.*	import com.greensock.easing.*		import com.davidcaneso.framework.SiteManager	import com.davidcaneso.events.loading.PreloaderEvent	import com.davidcaneso.loading.Preloader	import com.davidcaneso.display.drawing.SquareArea		public class SiteSectionPreloader extends Preloader	{		private var _top:MovieClip;		private var _visual:MovieClip;		private var _skipButton:Sprite;        private var _visualHideY:int = -17;        private var _visualShowY:int = 8;				private static const CLASS_NAME:String = 'SiteSectionPreloader';				public function SiteSectionPreloader(top:MovieClip, visual:MovieClip):void		{			_top = top;            _visual = visual;			addEventListener(Event.ADDED_TO_STAGE, init)		}				//	public methods		public function animateIn():void		{			//			hideSkipIntroButton();//			if(_visual.scaleX == 1)	_visual.scaleX = 0;			if(SiteManager(_top).nextSectionNumber > 0)			{				TweenMax.killTweensOf(_visual);				TweenMax.to(_visual, .3, {y:_visualShowY, autoAlpha:1, ease:Quad.easeOut, onComplete:animateInComplete});                _visual.gotoAndStop(0);			}			else			{				animateInComplete();			}		}				//	private methods		private function init(e:Event):void		{			removeEventListener(Event.ADDED_TO_STAGE, init);			//addEventListener(Event.REMOVED_FROM_STAGE, kill);						/*			var bar:SquareArea = new SquareArea(100, 20, 0xff0000);			_visual.addChild(bar);			_visual.scaleX = 0;			addChild(_visual);			*/			_skipButton = new Sprite();			_skipButton.alpha = 0;			_skipButton.visible = false;			_skipButton.x = 50;			//_skipButton.y = bar.height + 10;			_skipButton.mouseChildren = false;			_skipButton.buttonMode = true;			_skipButton.addEventListener(MouseEvent.CLICK, handleSkipClick);			//addChild(_skipButton);						var skipText:TextField = new TextField();			skipText.width = 100;			skipText.height = 50;			//skipText.autoSize = TextFieldAutoSize.LEFT			skipText.text = 'skip intro';			var skipArea:SquareArea = new SquareArea(skipText.width, skipText.height, 0xff0000);			_skipButton.addChild(skipArea);			_skipButton.addChild(skipText);						super.addEventListener(	PreloaderEvent.FILE_CHANGE, newFileLoading			);			super.addEventListener(	PreloaderEvent.UPDATE,		updateLoader			);			super.addEventListener(	PreloaderEvent.COMPLETE,	animateOut				);		}				private function kill(e:Event):void		{			removeEventListener(		Event.ADDED_TO_STAGE, 				init					);			removeEventListener(		Event.REMOVED_FROM_STAGE, 			kill					);						//stage.removeEventListener(	SiteManagerEvent.STOP_CURRENT_LOAD, handleStopCurrentLoad	);						super.removeEventListener(	PreloaderEvent.FILE_CHANGE, 		newFileLoading			);			super.removeEventListener(	PreloaderEvent.UPDATE,				updateLoader			);			super.removeEventListener(	PreloaderEvent.COMPLETE,			animateOut				);						super.destroy()		}				private function newFileLoading(e:PreloaderEvent):void		{			var target:DisplayObjectContainer = DisplayObjectContainer(e.loadTarget);						if(target == _top.introHolder){				showSkipIntroButton();				if(SiteManager(_top).siteState != SiteManager.INITIAL_LOADING_STATE)				{					SiteManager(_top).changeSiteState(SiteManager.INTRO_LOADING_STATE)				}			}		}				private function animateInComplete():void		{			super.startLoad();		}				private function animateOut(e:PreloaderEvent):void		{			//classTrace('animateOut')			var skipIntro:Boolean = MovieClip(_top).skipSectionIntro;						hideSkipIntroButton();			TweenMax.killTweensOf(_visual);			//TweenMax.to(_visual, .5, {y:_visualHideY, autoAlpha:0, ease:Quad.easeOut, onComplete:animateOutComplete, onCompleteParams:[skipIntro]})            TweenMax.to(_visual, .5, {y:_visualHideY, autoAlpha:0, ease:Quad.easeOut, onStart:animateOutComplete, onStartParams:[skipIntro]})		}						private function animateOutComplete(skipIntro:Boolean):void		{			MovieClip(_top).showLoadedSection(skipIntro)		}				private function updateLoader(e:PreloaderEvent):void		{			var percentage:int = e.percent;			//trace("update the loader to reflect "+ percentage +" loaded "+percentage / 100)			//_visual.scaleX = percentage * .01            _visual.gotoAndStop(percentage);		}				private function showSkipIntroButton():void		{			classTrace('showSkipIntroButton' + '\n\n');			TweenMax.to(_skipButton, .2, {autoAlpha:1, ease:Expo.easeOut})		}				private function hideSkipIntroButton():void		{			TweenMax.to(_skipButton, .2, {autoAlpha:0, ease:Expo.easeOut})		}				private function handleSkipClick(e:MouseEvent):void		{			switch(e.type)			{				case MouseEvent.CLICK:					classTrace("hit skipIntroClick");					super.stopLoad();					super.clearLoadStack();					_top.skipSectionIntro = true;					animateOut(null);					break;			}		}				//	development methods		private function classTrace(val:*):void		{			if(!super.showTraces) return;			trace(val+' in '+CLASS_NAME)		}	}	}